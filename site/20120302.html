<html>
<head>
<title>Fillets - JakeMadeThis</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="assets/jquery.color.js"></script>
<link rel="stylesheet" href="assets/style.css" />
<script src="assets/script.js"></script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31265649-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>

<div id="container">
  <div class="row">
    <div class="left side">
      <ul class="nav" data-hover-color="#aa00ff">
        <li><a href="home.html">jakemadethis</a></li>
        <li><a href="blog.html">blog</a></li>
        <li><a href="projects.html">projects</a></li>
        <li><a href="experiments.html">experiments</a></li>
      </ul>
      
      <ul class="tags" data-hover-color="#00aaff">
      
       <li><a href="pinball.html">pinball</a></li>
      
       <li><a href="blog.html">blog</a></li>
      
      </ul>
      
    </div>
    <div class="center" data-hover-color="#ff6600">
      
      <div id="header">
        <h1>Fillets</h1>
      </div>
      <div id="page">
        <p>I wanted a way to automatically round off corners in a path. In engineering this is called a &#8216;fillet&#8217;, in fact Fireworks has an option to fillet a path but I could not find an algorithm to do this so I had to figure it out.</p>
      <div class="image">
        <img src="http://i.imgur.com/OSYTo.png" />
        <span>The end result &#8211; a filleted path </span>
      </div>
<p>Now, drawing an arc is pretty simple but this requires finding the position of the centre of the arc from the two lines.</p>
<p>So the problem here is given the points p0, p1, p2 and the length r, find the point c.</p>
<p>Originally I was doing some trigonometry involving the sine rule to find the distance from c to p1. This was hefty and I kept getting issues from different quadrants and problems finding the average of two angles. Anyway, this was getting far too much effort than it was worth and I was about to give up, but just then I realised I could use vectors and everything was so much easier.</p>
      <div class="image">
        <img src="http://i.imgur.com/cCoMl.png" />
        
      </div>
<p>Firstly:</p>
<pre><code>p1to0 = (p0 - p1).normalize()
p1to2 = (p2 - p1).normalize()
mid = (p1to0 + p1to2).normalize()</code></pre>
<p>mid is now a direction vector pointing to c from p1</p>
<p>Now the distance from p1 to c I knew from my failed trigonometry attempts was r/(sin theta/2) where theta was the angle between the two lines. We all know that the sin of the angle between two vectors is the cross product of each. Therefore:</p>
<pre><code>hyp = r / abs(p1to0.cross(mid))</code></pre>
<p>And then c can be found by the following</p>
<pre><code>c = mid.multiply(hyp).add(p1)</code></pre>
<p>Simple five lines of code which works whichever direction the lines are coming from. The only thing to look out for is when the lines are parallel and a divide-by-zero error occurs.</p>
<p>As a bonus</p>
<p>I also needed to find the points where the circle touched the lines. This was also easy.</p>
<pre><code>p1to2normal = p1to2.normal() // counter-clockwise normal
p1to0normal = -p1to0.normal() // clockwise normal
// These normals should point 'outwards' from c
if p1to0.cross(p1to2) &lt; 0 then
  p1to2normal *= -1
  p1to0normal *= -1
end
a = p1to2normal.multiply(r).add(c)
b = p1to0normal.multiply(r).add(c)</code></pre>
<p>Hope this helps someone!</p>
      </div>

      


      <div id="footer" class="row">
          jakemadethis
      </div>

    </div>
    <div class="right side" data-hover-color="#ff6600">
      
        <p>
          Written on 2012-03-02
        </p>
      
      
    </div>

  </div>
  <div class="clear"></div>
</div>

</body>
</html>